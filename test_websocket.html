<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Client Test</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        #logs {
            background: #f5f5f5;
            padding: 10px;
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .log-entry { margin: 2px 0; }
        .log-time { color: #666; }
        .log-event { color: #2196F3; font-weight: bold; }
        .log-message { color: #333; }
        .log-error { color: #f44336; }
        .log-success { color: #4CAF50; }
        .controls { margin: 10px 0; }
        button { margin: 5px; padding: 8px 16px; }
    </style>
</head>
<body>
    <h1>WebSocket Client Test</h1>

    <div class="controls">
        <button onclick="connect()">Connect</button>
        <button onclick="disconnect()">Disconnect</button>
        <button onclick="sendPing()">Send Ping</button>
        <button onclick="clearLogs()">Clear Logs</button>
        <input type="text" id="clientId" placeholder="Client ID" value="test_client_1">
    </div>

    <div id="logs"></div>

    <script>
        let ws = null;
        const logsDiv = document.getElementById('logs');

        function addLog(message, className = '') {
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + className;
            entry.innerHTML = `<span class="log-time">[${time}]</span> <span class="log-message">${message}</span>`;
            logsDiv.appendChild(entry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function connect() {
            const clientId = document.getElementById('clientId').value || 'anonymous';

            if (ws && ws.readyState === WebSocket.OPEN) {
                addLog('Already connected', 'log-error');
                return;
            }

            // –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å
            const wsUrl = `ws://127.0.0.1:8000/ws/posts?client_id=${encodeURIComponent(clientId)}`;
            // –∏–ª–∏ –¥–ª—è HTTPS:
            // const wsUrl = `wss://127.0.0.1:8000/ws/posts?client_id=${encodeURIComponent(clientId)}`;

            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                addLog(`‚úÖ Connected as ${clientId}`, 'log-success');
            };

            ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    addLog(`üì• ‚Üê ${data.event || 'message'}: ${JSON.stringify(data).substring(0, 100)}`, 'log-event');
                } catch (e) {
                    addLog(`üì• ‚Üê ${event.data}`, 'log-message');
                }
            };

            ws.onclose = () => {
                addLog('üîå Disconnected', 'log-error');
                ws = null;
            };

            ws.onerror = (error) => {
                addLog(`‚ùå Error: ${error.message}`, 'log-error');
            };
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }

        function sendPing() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ event: "ping", timestamp: new Date().toISOString() }));
                addLog('üì§ ‚Üí ping', 'log-event');
            } else {
                addLog('Not connected', 'log-error');
            }
        }

        function clearLogs() {
            logsDiv.innerHTML = '';
        }

        // –ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = connect;
    </script>
</body>
</html>